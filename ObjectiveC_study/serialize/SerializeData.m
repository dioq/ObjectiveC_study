//
//  SerializeData.m
//  AnalyseData
//
//  Created by Dio Brand on 2023/3/20.
//

#import "SerializeData.h"
#import "CryptoUtil.h"

@interface SerializeData()

@property(nonatomic, strong)NSFileManager *fileManager;

@end

@implementation SerializeData

+ (instancetype)sharedManager {
    static SerializeData *staticInstance = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        staticInstance = [[super allocWithZone:NULL] init];
        staticInstance.fileManager = [NSFileManager defaultManager];
    });
    return staticInstance;
}

+(id)allocWithZone:(struct _NSZone *)zone{
    return [[self class] sharedManager];
}

-(id)copyWithZone:(struct _NSZone *)zone{
    return [[self class] sharedManager];
}

-(void)start {
    [self parseplist];
//    [self base64Decode];
}

-(void)parseplist {
    NSString *plistHexStr = @"62706C6973743030D2010203045756657273696F6E5541727261791001A7050A0B0C0D2829D2060708095F10105F434655524C537472696E67547970655C5F434655524C537472696E67100F5F107368747470733A2F2F7265732E77782E71712E636F6D2F6F705F7265732F5766317651306871306646575A47667977726275524B36566369696830794B374B6B546D6D5A5A504235507552514D6148514F6A6D49304A6571766E37364C63456F656C6A6F6E4A7142736A77714C7442664B6770772341C4E5758EF85387100010C8DD0E0F101112131415161718191A1B1C1D1E1F20212223242526275C436F6E74656E742D547970655E582D4E57532D4C4F472D5555494453416765565365727665725E582D43616368652D4C6F6F6B75705D43616368652D436F6E74726F6C54446174655E436F6E74656E742D4C656E6774685A436F6E6E656374696F6E585F5F686861615F5F5D4163636570742D52616E67657354566172795D4C6173742D4D6F64696669656459696D6167652F706E675F10143130393830353736363531313637343236313538563137353231375B4C65676F20536572766572594361636865204869745E6D61782D6167653D3630343830305F101D5765642C203232204D617220323032332030373A35313A353720474D5454323833385A6B6565702D616C6976655F1102700D0A0D0A596E427361584E304D44446341514944424155474277674A4367734D4451385245785558475273644879456A58454E76626E526C626E517456486C775A5635594C5535585579314D543063745656564A52464E425A32565755325679646D5679586C67745132466A61475574544739766133567758554E685932686C4C554E76626E527962327855524746305A563544623235305A5735304C55786C626D643061467044623235755A574E30615739755855466A59325677644331535957356E5A584E55566D46796556314D59584E304C5531765A476C6D6157566B6F51355A615731685A3255766347356E6F524266454251784D446B344D4455334E6A59314D5445324E7A51794E6A45314F4B4553566A45334E5449784E3645555730786C5A32386755325679646D56796F525A5A5132466A6147556753476C306F526865625746344C57466E5A5430324D4451344D444368476C38514856646C5A4377674D6A496754574679494449774D6A4D674D4463364E5445364E546367523031556F5278554D6A677A4F4B4565576D746C5A58417459577870646D5768494656696558526C63364569566B3979615764706271456B58784164545739754C4341794D43424E595849674D6A41794D7941774E7A6F784D446F774D43424854565141434141684143344150514242414567415677426C41476F4165514345414A49416C77436C414B63417351437A414D6F417A414454414E55413451446A414F30413777442B4151414249414569415363424B514530415459425041452B41555542527741414141414141414942414141414141414141435541414141414141414141414141414141414141466E556279746573564F726967696E5F101D4D6F6E2C203230204D617220323032332030373A31303A303020474D54110B1659696D6167652F706E670008000D0015001B001D0025002A003D004A004C00C200CB00CD00CF00EA00F70106010A01110120012E01330142014D015601640169017701810198019F01AB01B501C401E401E901F40468046E0475049504980000000000000201000000000000002A000000000000000000000000000004A2";
    
    
    NSData *data = [CryptoUtil hexDecode:plistHexStr];
    // 创建文件时写入内容
    NSString *filePath = @"/Users/dio/Documents/WeChat/001.plist";
    NSLog(@"%@",filePath);
    BOOL suc = [_fileManager createFileAtPath:filePath contents:data attributes:nil];
    if (suc) {
        NSLog(@"success");
    }else{
        NSLog(@"fail");
    }
}

-(void)base64Decode {
    NSString *base64Str = @"3nGzS9S0vD2x18p0HM8brGLy+qROCMS4FjB7KUVA2JHXN/iAnyreVNqdtyXVGXvycwxY4M1gSEtwtqj56TwXHw==";
    NSData *data = [CryptoUtil base64Decode:base64Str];
    NSLog(@"data:\n%@",data);
    NSString *hexStr = [CryptoUtil hexEncode:data];
    NSLog(@"hex:\n%@",hexStr);
}

@end
